import{a as s,b as e}from"./page-wraper.D_DLAzgo.js";import{d as a,an as o,z as r,b as t,e as p,f as n,g as l,w as m,A as i,x as c,p as f,B as u,K as h,J as d,ak as g,a6 as y,ae as b,aI as j,m as k}from"./index-Bl407YMq.js";import{u as v}from"./useChildren.CidG9Z_9.js";import{h as x,F as C}from"./ht-loading.DCn6to1m.js";import{_ as E}from"./base64.CiSqhNY6.js";const O=E(a({name:"ht-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:x,setup(a,{expose:x}){const{show:E}=s("ht-form-toast"),O=a,{children:_,linkChildren:w}=v(C);let I=o({});function T(s){s?I[s]="":Object.keys(I).forEach((s=>{I[s]=""}))}return w({props:O,errorMessages:I}),r((()=>O.model),(()=>{O.resetOnChange&&T()}),{immediate:!0,deep:!0}),x({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=j(O.rules),e=_.map((s=>s.prop));return Object.keys(s).forEach((a=>{e.includes(a)||delete s[a]})),_.forEach((e=>{d(e.prop)&&d(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=h(s)?s:d(s)?[s]:[],p=t.length>0?t.reduce(((s,e)=>(r[e]&&(s[e]=r[e]),s)),{}):r;for(const n in p){const s=p[n],r=g(O.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!d(r)||""===r)){e.push({prop:n,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:n,message:t.message}),a=!1;break}const{validator:s,...p}=t;if(s){const l=s(r,p);y(l)?o.push(l.then((s=>{"string"==typeof s?(e.push({prop:n,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),a=!1)})).catch((s=>{const o=d(s)?b(s)?s:s.message||t.message:t.message;e.push({prop:n,message:o}),a=!1}))):l||(e.push({prop:n,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=_.map((s=>s.prop)).filter(Boolean),a=s.filter((s=>s.message&&e.includes(s.prop)));a.length&&(a.sort(((s,a)=>e.indexOf(s.prop)-e.indexOf(a.prop))),"toast"===O.errorType?E(a[0].message):"message"===O.errorType&&a.forEach((s=>{I[s.prop]=s.message})))}(e),a&&(t.length?t.forEach(T):T()),{valid:a,errors:e}},reset:function(){T()}}),(s,a)=>{const o=t(p("ht-toast"),e),r=k;return n(),l(r,{class:f(`ht-form ${s.customClass}`),style:u(s.customStyle)},{default:m((()=>[i(s.$slots,"default",{},void 0,!0),"toast"===O.errorType?(n(),l(o,{key:0,selector:"ht-form-toast"})):c("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-22590d11"]]);export{O as _};
