import{c as e}from"./ht-loading.DCn6to1m.js";import{K as a,aH as l,M as t,d as n,r as s,z as o,b as u,e as i,f as r,g as c,w as d,h as m,x as v,B as h,k as g,l as f,F as p,p as y,aI as b,ay as k,aJ as _,aw as w,m as x,aK as C,i as K,t as $,J as I,I as S,aL as E}from"./index-Bl407YMq.js";import{b as P,d as V,c as H,m as O,g as j,_ as D}from"./base64.CiSqhNY6.js";function A(e,n,s){let o=a(e)?e:[e];const u=new Set(e.map(l));if(1!==u.size&&u.has("object"))throw Error("The columns are correct");a(e[0])||(o=[o]);return o.map((e=>e.map((e=>{if(!t(e))return{[n]:e,[s]:e};if(!e.hasOwnProperty(n)&&!e.hasOwnProperty(s))throw Error("Can't find valueKey and labelKey in columns");return e.hasOwnProperty(s)||(e[s]=e[n]),e.hasOwnProperty(n)||(e[n]=e[s]),e}))))}const F=D(n({name:"ht-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...P,loading:V(!1),loadingColor:H("#4D80F0"),columnsHeight:O(217),valueKey:H("value"),labelKey:H("label"),immediateChange:V(!1),modelValue:{type:[String,Number,Boolean,Array,Array,Array],default:"",required:!0},columns:j(),columnChange:Function},emits:["change","pickstart","pickend","update:modelValue"],setup(t,{expose:n,emit:P}){const V=t,H=P,O=s([]),j=s(35),D=s([]);o([()=>V.modelValue,()=>V.columns],((e,t)=>{w(t[1],e[1])||(a(e[1])&&e[1].length>0?O.value=A(e[1],V.valueKey,V.labelKey):(O.value=[],D.value=[])),I(e[0])&&function(e){if(0===O.value.length)return void(D.value=[]);(""===e||!I(e)||a(e)&&0===e.length)&&(e=O.value.map((e=>e[0][V.valueKey])));const t=l(e),n=["string","number","boolean","array"];-1===n.indexOf(t)&&console.error(`value must be one of ${n.toString()}`);e=(e=a(e)?e:[e]).slice(0,O.value.length);let s=b(D.value);e.forEach(((e,a)=>{let l=O.value[a].findIndex((a=>a[V.valueKey].toString()===e.toString()));l=-1===l?0:l,s=T(a,l,s)})),D.value=s.slice(0,e.length)}(e[0])}),{deep:!0,immediate:!0});const{proxy:F}=S();function T(e,a,l){const t=O.value[e];if(!t||!t[a])throw Error(`The value to select with Col:${e} Row:${a} is incorrect`);const n=b(l);if(n[e]=a,t[a].disabled){const l=t.slice(0,a).reverse().findIndex((e=>!e.disabled)),s=t.slice(a+1).findIndex((e=>!e.disabled));-1!==l?n[e]=a-1-l:-1!==s?n[e]=a+1+s:void 0===n[e]&&(n[e]=0)}return n}function z({detail:{value:e}}){const a=function(e){e=e.slice(0,O.value.length);const a=b(D.value);let l=b(D.value);e.forEach(((e,t)=>{(e=_(e,0,O.value[t].length-1))!==a[t]&&(l=T(t,e,l))}));const t=function(e,a){if(!e||!a)return-1;const l=e.findIndex(((e,l)=>e!==a[l]));return l}(l,a);if(-1===t)return;const n=l[t];return 1===l.length?n:t}(e=e.map((e=>Number(e||0))));D.value=b(e),k((()=>{D.value=function(e){let a=b(e);return e.forEach(((e,l)=>{e=_(e,0,O.value[l].length-1),a=T(l,e,a)})),a}(e),V.columnChange?V.columnChange.length<4?(V.columnChange(F.$.exposed,J(),a||0,(()=>{})),B(a||0)):V.columnChange(F.$.exposed,J(),a||0,(()=>{B(a||0)})):B(a||0)}))}function B(e){const a=L();w(a,V.modelValue)||(H("update:modelValue",a),setTimeout((()=>{H("change",{picker:F.$.exposed,value:a,index:e})}),0))}function J(){const e=D.value.map(((e,a)=>O.value[a][e]));return 1===e.length?e[0]:e}function L(){const{valueKey:e}=V,a=D.value.map(((a,l)=>O.value[l][a][e]));return 1===a.length?a[0]:a}function N(){H("pickstart")}function q(){H("pickend")}return n({getSelects:J,getValues:L,setColumnData:function(e,a,l=0){O.value[e]=A(a,V.valueKey,V.labelKey).reduce(((e,a)=>e.concat(a)),[]),D.value=T(e,l,D.value)},getColumnsData:function(){return b(O.value)},getColumnData:function(e){return O.value[e]},getColumnIndex:function(e){return D.value[e]},getLabels:function(){const{labelKey:e}=V;return D.value.map(((a,l)=>O.value[l][a][e]))},getSelectedIndex:function(){return D.value},resetColumns:function(e){a(e)&&e.length&&(O.value=A(e,V.valueKey,V.labelKey))}}),(a,l)=>{const t=u(i("ht-loading"),e),n=x,s=E,o=C;return r(),c(n,{class:y(`ht-picker-view ${a.customClass}`),style:h(a.customStyle)},{default:d((()=>[a.loading?(r(),c(n,{key:0,class:"ht-picker-view__loading"},{default:d((()=>[m(t,{color:a.loadingColor},null,8,["color"])])),_:1})):v("",!0),m(n,{style:h(`height: ${a.columnsHeight-20}px;`)},{default:d((()=>[m(o,{"mask-class":"ht-picker-view__mask","indicator-class":"ht-picker-view__roller","indicator-style":`height: ${j.value}px;`,style:h(`height: ${a.columnsHeight-20}px;`),value:D.value,"immediate-change":a.immediateChange,onChange:z,onPickstart:N,onPickend:q},{default:d((()=>[(r(!0),g(p,null,f(O.value,((e,l)=>(r(),c(s,{key:l,class:"ht-picker-view-column"},{default:d((()=>[(r(!0),g(p,null,f(e,((e,t)=>(r(),c(n,{key:t,class:y(`ht-picker-view-column__item ${e.disabled?"ht-picker-view-column__item--disabled":""}  ${D.value[l]==t?"ht-picker-view-column__item--active":""}`),style:h(`line-height: ${j.value}px;`)},{default:d((()=>[K($(e[a.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value","immediate-change"])])),_:1},8,["style"])])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-f6ebf728"]]);export{F as _,A as f};
