import{d as e,r as a,V as l,W as t,z as u,c as s,b as o,e as i,f as n,g as c,w as r,h as v,p as m,B as h,x as p,i as d,t as g,j as f,C as _,D as x,m as y,s as w,X as b,Y as k,Z as $,I as S,_ as T,u as C,k as M,l as j,F as V,$ as I}from"./index-Bl407YMq.js";import{b as N,d as F,c as P,m as z,e as H,a as R,_ as W}from"./base64.CiSqhNY6.js";import{_ as Y}from"./ht-button.8vkNbh4T.js";import{u as q}from"./useTranslate.C8VGrN03.js";import{_ as U}from"./ht-img.CwKQUdVA.js";import{_ as X}from"./demo-block.DyA2odLx.js";import{a as A,_ as B}from"./page-wraper.D_DLAzgo.js";import{u as D}from"./types.BlFdZI_L.js";import"./ht-loading.DCn6to1m.js";const E=e({name:"ht-img-cropper",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...N,modelValue:F(!1),cancelButtonText:String,confirmButtonText:String,disabledRotate:F(!1),fileType:P("png"),quality:z(1),exportScale:z(2),imgSrc:P(""),imgWidth:H(""),imgHeight:H(""),maxScale:z(3),aspectRatio:P("1:1")},emits:["imgloaded","imgloaderror","cancel","confirm","update:modelValue"],setup(e,{expose:C,emit:M}){const j=a(`cropper${l()}`);let V=null,I=null,N=!0,F=null,P=null;const z=.85,H=e,W=M,{translate:U}=q("img-cropper"),X=a(0),A=a(!1),B=a(0),D=a(0),E=a(0),O=a(0),G=a(20),L=a(0),Z=a(0),J=a(""),K=a(""),Q=a(2),ee=a(1),ae=a(t().windowWidth/2),le=a(t().windowHeight/2*z),te=a(null),ue=a(t()),se=a(!0),oe=a([{x:"",y:""},{x:"",y:""}]),ie=a(""),ne=a(null),{proxy:ce}=S();u((()=>H.modelValue),(e=>{if(e){F=H.imgWidth,P=H.imgHeight,ue.value=t();const[e,a]=H.aspectRatio.split(":").map(Number),l=ue.value.windowWidth-2*G.value,u=l*a/e;E.value=l,O.value=u,Z.value=(ue.value.windowHeight*z-u)/2,L.value=G.value,Q.value=H.exportScale,K.value=u,J.value=l,function(){if(F&&"string"==typeof F&&-1!==F.indexOf("%")){const e=F.replace("%","");F=ue.value.windowWidth/100*Number(e),B.value=F}else F&&"number"==typeof F&&(B.value=F);if(P&&"string"==typeof P&&-1!==P.indexOf("%")){const e=H.imgHeight.replace("%","");P=ue.value.windowHeight/100*Number(e),B.value=P}else P&&"number"==typeof P&&(B.value=Number(F))}(),ne.value||(ne.value=$(j.value,ce)),H.imgSrc&&de()}else pe()}),{deep:!0,immediate:!0}),u((()=>H.imgSrc),(e=>{e&&de()}),{deep:!0,immediate:!0}),u((()=>X.value),(e=>{e%90&&(X.value=90*Math.round(e/90))}),{deep:!0,immediate:!0}),u((()=>A.value),(e=>{V&&clearTimeout(V),e&&(V=setTimeout((()=>{me(!1),clearTimeout(V)}),300))}),{deep:!0,immediate:!0});const re=s((()=>_({position:"absolute",right:0,width:"56px","border-radius":"16px","font-size":"16px"}))),ve=s((()=>{const e={width:B.value?x(B.value):"auto",height:D.value?x(D.value):"auto",transform:`translate(${x(ae.value-B.value/2)}, ${x(le.value-D.value/2)}) scale(${ee.value}) rotate(${X.value}deg)`,"transition-duration":(A.value?.4:0)+"s"};return _(e)}));function me(e){A.value=e}function he(e){if(!e||H.disabledRotate)return;me(!0),X.value=e;let a=B.value,l=D.value;e/90%2&&(a=D.value,l=B.value);const t=E.value/a,u=O.value/l;ee.value=Math.max(t,u),ge()}function pe(){const{windowHeight:e,windowWidth:a}=t();ee.value=1,X.value=0,ae.value=a/2,le.value=e/2*z}function de(){H.imgSrc&&k({src:H.imgSrc,success:e=>{te.value=e,function(){let e=B.value,a=D.value;if(P||F)P&&!F?(a=Number(P),e=te.value.width/te.value.height*a):(!P&&F||P&&F)&&(e=Number(F),a=te.value.height/te.value.width*e);else{const l=te.value.width/te.value.height;l>E.value/O.value?(a=O.value,e=a*l):(e=E.value,a=e/l)}const l=E.value/e,t=O.value/a,u=Math.max(l,t);B.value=e,D.value=a,ee.value=u}(),pe()},fail:()=>{}})}function ge(e){const a=e||ee.value;let l=ae.value,t=le.value,u=B.value,s=D.value;X.value/90%2&&(u=D.value,s=B.value),l=u*a/2+L.value>=l?l:u*ee.value/2+L.value,l=L.value+E.value-u*a/2<=l?l:L.value+E.value-u*a/2,t=s*a/2+Z.value>=t?t:s*a/2+Z.value,t=Z.value+O.value-s*a/2<=t?t:Z.value+O.value-s*a/2,ee.value=a,le.value=t,ae.value=l}function fe(e){if(se.value=!1,1===e.touches.length)oe.value[0]={x:e.touches[0].clientX-ae.value,y:e.touches[0].clientY-le.value};else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY);ie.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function _e(e){if(!se.value&&N)if("android"===ue.value.platform?(I&&clearTimeout(I),I=setTimeout((()=>{N=!0}),25)):!N&&(N=!0),1===e.touches.length){const{x:a,y:l}=oe.value[0],t=e.touches[0].clientX-Number(a),u=e.touches[0].clientY-Number(l);ae.value=t,le.value=u,ge()}else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY),t=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),u=ee.value*(t/Number(ie.value));ee.value=Math.min(u,H.maxScale),function(){let e=B.value,a=D.value,l=ee.value;X.value/90%2&&(e=D.value,a=B.value),e*l<E.value&&(l=E.value/e),a*l<O.value&&(l=O.value/a),ge(l)}(),ie.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function xe(){se.value=!0}function ye(e){W("imgloaded",e)}function we(e){W("imgloaderror",e)}function be(){he(X.value-90)}function ke(){W("cancel"),W("update:modelValue",!1)}function $e(){!function(){if(!H.imgSrc)return;const e=()=>{const e=B.value*ee.value*H.exportScale,a=D.value*ee.value*H.exportScale,l=ae.value-L.value,t=le.value-Z.value;ne.value.translate(l*H.exportScale,t*H.exportScale),H.disabledRotate||ne.value.rotate(X.value*Math.PI/180),ne.value.drawImage(H.imgSrc,-e/2,-a/2,e,a),ne.value.restore(),ne.value.draw(!1,(()=>{!function(){const{fileType:e,quality:a,exportScale:l}=H;T({width:E.value*l,height:Math.round(O.value*l),destWidth:E.value*l,destHeight:Math.round(O.value*l),fileType:e,quality:a,canvasId:j.value,success:e=>{const a={tempFilePath:e.tempFilePath,width:E.value*l,height:O.value*l};W("confirm",a)},complete:()=>{W("update:modelValue",!1)}},ce)}()}))};K.value=O.value,J.value=E.value,e()}()}function Se(){}return C({revertIsAnimation:me,setRoate:he,resetImg:pe}),(e,a)=>{const l=y,t=w,u=b,s=o(i("ht-icon"),R),_=o(i("ht-button"),Y);return e.modelValue?(n(),c(l,{key:0,class:m(`ht-img-cropper ${e.customClass}`),style:h(e.customStyle),onTouchmove:Se},{default:r((()=>[v(l,{class:"ht-img-cropper__wrapper"},{default:r((()=>[v(l,{class:"ht-img-cropper__cut"},{default:r((()=>[v(l,{class:m("ht-img-cropper__cut--top "+(se.value?"":"is-hightlight")),style:h(`height: ${Z.value}px;`)},null,8,["class","style"]),v(l,{class:"ht-img-cropper__cut--middle",style:h(`height: ${O.value}px;`)},{default:r((()=>[v(l,{class:m("ht-img-cropper__cut--left "+(se.value?"":"is-hightlight")),style:h(`width: ${L.value}px; height: ${O.value}px;`)},null,8,["class","style"]),v(l,{class:"ht-img-cropper__cut--body",style:h(`width: ${E.value}px; height: ${O.value}px;`)},{default:r((()=>[v(l,{class:"is-gridlines-x"}),v(l,{class:"is-gridlines-y"}),v(l,{class:"is-left-top"}),v(l,{class:"is-left-bottom"}),v(l,{class:"is-right-top"}),v(l,{class:"is-right-bottom"})])),_:1},8,["style"]),v(l,{class:m("ht-img-cropper__cut--right "+(se.value?"":"is-hightlight"))},null,8,["class"])])),_:1},8,["style"]),v(l,{class:m("ht-img-cropper__cut--bottom "+(se.value?"":"is-hightlight"))},null,8,["class"])])),_:1}),v(t,{prop:A.value,"change:prop":e.animation?e.animation.setAnimation:"",class:"ht-img-cropper__img",src:e.imgSrc,style:h(ve.value),"lazy-load":!1,onTouchstart:fe,onTouchmove:_e,onTouchend:xe,onError:we,onLoad:ye},null,8,["prop","change:prop","src","style"])])),_:1}),v(u,{"canvas-id":j.value,id:j.value,class:"ht-img-cropper__canvas","disable-scroll":!0,style:h(`width: ${Number(J.value)*Q.value}px; height: ${Number(K.value)*Q.value}px;`)},null,8,["canvas-id","id","style"]),v(l,{class:"ht-img-cropper__footer"},{default:r((()=>[e.disabledRotate?p("",!0):(n(),c(s,{key:0,"custom-class":"ht-img-cropper__rotate",name:"rotate",onClick:be})),v(l,{class:"ht-img-cropper__footer--button"},{default:r((()=>[v(l,{class:"is-cancel",onClick:ke},{default:r((()=>[d(g(e.cancelButtonText||f(U)("cancel")),1)])),_:1}),v(_,{size:"small","custom-style":re.value,onClick:$e},{default:r((()=>[d(g(e.confirmButtonText||f(U)("confirm")),1)])),_:1},8,["custom-style"])])),_:1})])),_:1})])),_:1},8,["class","style"])):p("",!0)}}});const O={setAnimation:function(e,a,l){if(e)var t=l.setTimeout((function(){l.callMethod("revertIsAnimation",!1),l.clearTimeout(t)}),300)}},G=e=>{e.$wxs||(e.$wxs=[]),e.$wxs.push("animation"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.animation=O}})};G(E);const L=W(E,[["__scopeId","data-v-7a34472d"]]),Z=W(e({__name:"Index",setup(e){const{t:l}=C(),{startUpload:t,UPLOAD_STATUS:u}=D(),{show:s}=A(),m=a(""),h=a(""),f=a(!1),_=a([!1,!1,!1]),x=a(["","",""]),w=a(["","",""]),b=a(!1),k=a(""),$=a("");function S(){I({count:1,success:e=>{const a=e.tempFilePaths[0];m.value=a,f.value=!0}})}function T(e){I({count:1,success:a=>{const l=a.tempFilePaths[0];x.value[e]=l,_.value[e]=!0}})}function N(){I({count:1,success:e=>{k.value=e.tempFilePaths[0],b.value=!0}})}function F(e){const{tempFilePath:a}=e;h.value=a}async function P(e){const{tempFilePath:a}=e,o={url:a,status:u.PENDING,percent:0,uid:(new Date).getTime()};try{await t(o,{action:"https://mockapi.eolink.com/zhTuw2P8c29bc981a741931bdd86eb04dc1e8fd64865cb5/upload",onSuccess(){$.value=a,s({msg:l("shang-chuan-cheng-gong")})},onError(){s({msg:l("shang-chuan-shi-bai")})},onProgress(e){console.log("上传进度:",e.progress)}})}catch(i){console.error("上传失败:",i)}}function z(e){console.log("加载失败",e)}function H(e){console.log("加载成功",e)}function W(e){console.log("取消",e)}function Y(e){console.log("取消",e)}function q(e){const[a,l]=e.split(":").map(Number);return"1:1"===e?"200px":300*l/a+"px"}return(e,a)=>{const l=o(i("ht-img-cropper"),L),t=o(i("ht-icon"),R),u=y,s=o(i("ht-img"),U),C=o(i("demo-block"),X),I=o(i("page-wraper"),B);return n(),c(I,null,{default:r((()=>[v(C,{title:e.$t("jiBenYongFa"),style:{"text-align":"center"}},{default:r((()=>[v(l,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),"img-src":m.value,onConfirm:F,onCancel:W,onImgloaderror:z,onImgloaded:H},null,8,["modelValue","img-src"]),v(u,{class:"profile"},{default:r((()=>[h.value?p("",!0):(n(),c(u,{key:0,class:"img",onClick:S},{default:r((()=>[v(t,{name:"fill-camera","custom-class":"img-icon"})])),_:1})),h.value?(n(),c(s,{key:1,round:"",width:"200px",height:"200px",src:h.value,mode:"aspectFit","custom-class":"profile-img",onClick:S},null,8,["src"])):p("",!0),v(u,{style:{"font-size":"14px"}},{default:r((()=>[d(g(e.$t("dian-ji-shang-chuan-tou-xiang")),1)])),_:1})])),_:1})])),_:1},8,["title"]),v(C,{title:e.$t("zi-ding-yi-cai-jian-bi-li"),style:{"text-align":"center"}},{default:r((()=>[v(u,{class:"profile-grid"},{default:r((()=>[(n(),M(V,null,j(["3:2","16:9","16:10"],((a,o)=>v(u,{key:o,class:"profile-item"},{default:r((()=>[v(l,{modelValue:_.value[o],"onUpdate:modelValue":e=>_.value[o]=e,"img-src":x.value[o],"aspect-ratio":a,onConfirm:e=>function(e,a){const{tempFilePath:l}=a;w.value[e]=l}(o,e),onCancel:Y},null,8,["modelValue","onUpdate:modelValue","img-src","aspect-ratio","onConfirm"]),w.value[o]?p("",!0):(n(),c(u,{key:0,class:"img",onClick:e=>T(o)},{default:r((()=>[v(t,{name:"fill-camera","custom-class":"img-icon"})])),_:2},1032,["onClick"])),w.value[o]?(n(),c(s,{key:1,width:"300px",height:q(a),src:w.value[o],mode:"aspectFit","custom-class":"profile-img",onClick:e=>T(o)},null,8,["height","src","onClick"])):p("",!0),v(u,{style:{"font-size":"14px"}},{default:r((()=>[d(g(a)+g(e.$t("bi-li-cai-jian")),1)])),_:2},1024)])),_:2},1024))),64))])),_:1})])),_:1},8,["title"]),v(C,{title:e.$t("cai-jian-hou-shang-chuan"),style:{"text-align":"center"}},{default:r((()=>[v(l,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value=e),"img-src":k.value,onConfirm:P,onCancel:W},null,8,["modelValue","img-src"]),v(u,{class:"profile"},{default:r((()=>[$.value?p("",!0):(n(),c(u,{key:0,class:"img",onClick:N},{default:r((()=>[v(t,{name:"fill-camera","custom-class":"img-icon"})])),_:1})),$.value?(n(),c(s,{key:1,round:"",width:"200px",height:"200px",src:$.value,mode:"aspectFit","custom-class":"profile-img",onClick:N},null,8,["src"])):p("",!0),v(u,{style:{"font-size":"14px"}},{default:r((()=>[d(g(e.$t("dian-ji-shang-chuan-cai-jian-hou-de-tou-xiang")),1)])),_:1})])),_:1})])),_:1},8,["title"])])),_:1})}}}),[["__scopeId","data-v-9142fdc3"]]);export{Z as default};
