import{d as e,r as s,an as t,b as o,e as a,f as l,g as i,w as r,h as n,x as u,H as c,p as d,B as p,ay as f,aS as m,m as v,c as h,z as _,k as y,F as b,l as g,A as k,i as w,t as C,J as x,j as L,aw as P,aa as T,ab as I,aI as z,aT as F,a0 as D,s as K,n as S,aU as U,al as j,E,Y as M}from"./index-Bl407YMq.js";import{b as N,a as $,_ as R}from"./base64.CiSqhNY6.js";import{g as A,c as G}from"./ht-loading.DCn6to1m.js";import{u as H}from"./useTranslate.C8VGrN03.js";import{a as B,u as J}from"./types.BlFdZI_L.js";const O=R(e({name:"ht-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...N},setup(e,{expose:h}){const _=s(!1),y=t({url:"",poster:"",title:""});function b(){_.value=!1,f((()=>{y.url="",y.poster="",y.title=""}))}return A((()=>_.value)),h({open:function(e){_.value=!0,y.url=e.url,y.poster=e.poster,y.title=e.title},close:b}),(e,s)=>{const t=m,f=v,h=o(a("ht-icon"),$);return _.value?(l(),i(f,{key:0,class:d(`ht-video-preview ${e.customClass}`),style:p(e.customStyle),onClick:b},{default:r((()=>[n(f,{class:"ht-video-preview__video",onClick:s[0]||(s[0]=c((()=>{}),["stop"]))},{default:r((()=>[y.url?(l(),i(t,{key:0,class:"ht-video-preview__video",controls:!0,poster:y.poster,title:y.title,"play-btn-position":"center",enableNative:!0,src:y.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):u("",!0)])),_:1}),n(h,{name:"close","custom-class":"ht-video-preview__close",onClick:b})])),_:1},8,["class","style"])):u("",!0)}}}),[["__scopeId","data-v-2f34b500"]]),Y=R(e({name:"ht-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:B,emits:["fail","change","success","progress","oversize","chooseerror","remove","update:fileList"],setup(e,{expose:t,emit:c}){const f=e,N=c;t({submit:()=>Z(),abort:()=>Q()});const{translate:R}=H("upload"),A=s([]),B=h((()=>!f.limit||A.value.length<f.limit)),Y=s(),{startUpload:q,abort:Q,chooseFile:V,UPLOAD_STATUS:W}=J();function X(){N("update:fileList",A.value)}function Z(){const{buildFormData:e,formData:s={},statusKey:t}=f,{action:o,name:a,header:l={},accept:i,successStatus:r,uploadMethod:n}=f,u=x(r)?r:200;for(const c of A.value)c[t]===W.PENDING&&(e?e({file:c,formData:s,resolve:e=>{e&&q(c,{action:o,header:l,name:a,formData:e,fileType:i,statusCode:u,statusKey:t,uploadMethod:n,onSuccess:oe,onError:te,onProgress:ae,abortPrevious:!0})}}):q(c,{action:o,header:l,name:a,formData:s,fileType:i,statusCode:u,statusKey:t,uploadMethod:n,onSuccess:oe,onError:te,onProgress:ae,abortPrevious:!0}))}function ee(e){return new Promise(((s,t)=>{M({src:e,success:e=>{s(e)},fail:e=>{t(e)}})}))}function se(e,s){const{statusKey:t}=f,o={uid:T.id++,name:e.name||"",thumb:e.thumb||"",[t]:"pending",size:e.size||0,url:e.path,percent:0};"number"==typeof s?A.value.splice(s,1,o):A.value.push(o),f.autoUpload&&Z()}function te(e,s,t){const{statusKey:o}=f,a=A.value.findIndex((e=>e.uid===s.uid));a>-1&&(A.value[a][o]="fail",A.value[a].error=e.message,A.value[a].response=e,N("fail",{error:e,file:s,formData:t}),X())}function oe(e,s,t){const{statusKey:o}=f,a=A.value.findIndex((e=>e.uid===s.uid));a>-1&&(A.value[a][o]="success",A.value[a].response=e.data,N("change",{fileList:A.value}),N("success",{file:s,fileList:A.value,formData:t}),X())}function ae(e,s){const t=A.value.findIndex((e=>e.uid===s.uid));t>-1&&(A.value[t].percent=e.progress,N("progress",{response:e,file:s}))}function le(e){const{multiple:s,maxSize:t,accept:o,sizeType:a,limit:l,sourceType:i,compressed:r,maxDuration:n,camera:u,beforeUpload:c,extension:d}=f;V({multiple:s,sizeType:a,sourceType:i,maxCount:l?l-A.value.length:9,accept:o,compressed:r,maxDuration:n,camera:u,extension:d}).then((o=>{let a=o;s||(a=a.slice(0,1));const l=async s=>{for(let o=0;o<s.length;o++){const a=s[o];if("image"===a.type&&!a.size){const e=await ee(a.path);a.size=e.width*e.height}Number(a.size)<=t?se(a,e):N("oversize",{file:a})}};c?c({files:a,fileList:A.value,resolve:e=>{e&&l(a)}}):l(a)})).catch((e=>{N("chooseerror",{error:e})}))}function ie(e){if(f.disabled)return;const{beforeChoose:s}=f;s?s({fileList:A.value,resolve:s=>{s&&le(e)}}):le(e)}function re(e){A.value.splice(A.value.findIndex((s=>s.uid===e.uid)),1),N("change",{fileList:A.value}),N("remove",{file:e}),X()}function ne(e){U({filePath:e.url,showMenu:!0})}function ue(e,s){const{onPreviewFail:t}=f;j({urls:s,current:s[e],fail(){t?t({index:e,imgList:s}):E({title:"预览图片失败",icon:"none"})}})}function ce(e,s){var t;null==(t=Y.value)||t.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function de(e){const{beforePreview:s,reupload:t}=f,o=z(A.value),a=o.findIndex((s=>s.url===e.url)),l=o.filter((e=>pe(e))),i=l.findIndex((s=>s.url===e.url));t?ie(a):s?s({file:e,index:a,imgList:[],fileList:o,resolve:e=>{e&&ce(i,l)}}):ce(i,l)}function pe(e){return e.name&&F(e.name)||F(e.url)}function fe(e){return e.name&&D(e.name)||D(e.url)}return _((()=>f.fileList),(e=>{const{statusKey:s}=f;if(P(e,A.value))return;const t=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",{...e,uid:T.id++})));A.value=t}),{deep:!0,immediate:!0}),_((()=>f.limit),(e=>{e&&e<A.value.length&&console.error("[ht-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),_((()=>f.beforePreview),(e=>{e&&!I(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),_((()=>f.onPreviewFail),(e=>{e&&!I(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),_((()=>f.beforeRemove),(e=>{e&&!I(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),_((()=>f.beforeUpload),(e=>{e&&!I(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),_((()=>f.beforeChoose),(e=>{e&&!I(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),_((()=>f.buildFormData),(e=>{e&&!I(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const t=K,c=o(a("ht-icon"),$),h=v,_=m,x=o(a("ht-loading"),G),P=S,T=o(a("ht-video-preview"),O);return l(),y(b,null,[n(h,{class:d(["ht-upload",e.customClass]),style:p(e.customStyle)},{default:r((()=>[(l(!0),y(b,null,g(A.value,((s,o)=>(l(),i(h,{class:d(["ht-upload__preview",e.customPreviewClass]),key:o},{default:r((()=>[n(h,{class:"ht-upload__status-content"},{default:r((()=>[fe(s)?(l(),i(t,{key:0,src:s.url,mode:e.imageMode,class:"ht-upload__picture",onClick:e=>function(e){const{beforePreview:s,reupload:t}=f,o=z(A.value),a=o.findIndex((s=>s.url===e.url)),l=o.filter((e=>fe(e))).map((e=>e.url)),i=l.findIndex((s=>s===e.url));t?ie(a):s?s({file:e,index:a,fileList:o,imgList:l,resolve:e=>{e&&ue(i,l)}}):ue(i,l)}(s)},null,8,["src","mode","onClick"])):pe(s)?(l(),y(b,{key:1},[s.thumb?(l(),i(h,{key:0,class:"ht-upload__video",onClick:e=>de(s)},{default:r((()=>[n(t,{src:s.thumb,mode:e.imageMode,class:"ht-upload__picture"},null,8,["src","mode"]),n(c,{name:"play-circle-filled","custom-class":"ht-upload__video-paly"})])),_:2},1032,["onClick"])):(l(),i(h,{key:1,class:"ht-upload__video",onClick:e=>de(s)},{default:r((()=>[n(_,{src:s.url,title:s.name||"视频"+o,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"ht-upload__video"},null,8,["src","title","poster"]),n(c,{name:"play-circle-filled","custom-class":"ht-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(l(),i(h,{key:2,class:"ht-upload__file",onClick:e=>function(e){const{beforePreview:s,reupload:t}=f,o=z(A.value),a=o.findIndex((s=>s.url===e.url));t?ie(a):s?s({file:e,index:a,imgList:[],fileList:o,resolve:s=>{s&&ne(e)}}):ne(e)}(s)},{default:r((()=>[n(c,{name:"file","custom-class":"ht-upload__file-icon"}),n(h,{class:"ht-upload__file-name"},{default:r((()=>[w(C(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s[f.statusKey]?(l(),i(h,{key:0,class:"ht-upload__mask ht-upload__status-content"},{default:r((()=>["loading"===s[f.statusKey]?(l(),i(h,{key:0,class:"ht-upload__status-content"},{default:r((()=>[n(x,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),n(P,{class:"ht-upload__progress-txt"},{default:r((()=>[w(C(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):u("",!0),"fail"===s[f.statusKey]?(l(),i(h,{key:1,class:"ht-upload__status-content"},{default:r((()=>[n(c,{name:"close-outline","custom-class":"ht-upload__icon"}),n(P,{class:"ht-upload__progress-txt"},{default:r((()=>[w(C(s.error||L(R)("error")),1)])),_:2},1024)])),_:2},1024)):u("",!0)])),_:2},1024)):u("",!0),"loading"===s[f.statusKey]||e.disabled?u("",!0):(l(),i(c,{key:1,name:"error-fill","custom-class":"ht-upload__close",onClick:e=>function(e){const{beforeRemove:s}=f,t=e,o=A.value[t];s?s({file:o,index:t,fileList:A.value,resolve:e=>{e&&re(o)}}):re(o)}(o)},null,8,["onClick"])),e.$slots["preview-cover"]?k(e.$slots,"preview-cover",{key:2,file:s,index:o},void 0,!0):u("",!0)])),_:2},1032,["class"])))),128)),B.value?(l(),y(b,{key:0},[e.$slots.default?(l(),i(h,{key:0,class:d(["ht-upload__evoke-slot",e.customEvokeClass]),onClick:ie},{default:r((()=>[k(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(l(),i(h,{key:1,onClick:ie,class:d(["ht-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:r((()=>[n(c,{class:"ht-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(l(),i(h,{key:0,class:"ht-upload__evoke-num"},{default:r((()=>[w("（"+C(A.value.length)+"/"+C(e.limit)+"）",1)])),_:1})):u("",!0)])),_:1},8,["class"]))],64)):u("",!0)])),_:3},8,["class","style"]),n(T,{ref_key:"videoPreview",ref:Y},null,512)],64)}}}),[["__scopeId","data-v-c616db1b"]]);export{Y as _};
