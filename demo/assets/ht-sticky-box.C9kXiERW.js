import{d as t,r as e,V as o,an as s,c as i,b as a,e as n,f as l,g as r,w as u,h,B as d,A as c,p,D as f,C as b,L as v,G as y,m,I as g,aB as x,a4 as $}from"./index-Bl407YMq.js";import{_ as k}from"./ht-resize.xwGoC66W.js";import{b as w,m as _,_ as C}from"./base64.CiSqhNY6.js";import{u as S}from"./ht-loading.DCn6to1m.js";import{u as z}from"./useChildren.CidG9Z_9.js";const I={...w,zIndex:_(1),offsetTop:_(0)},T=Symbol("ht-sticky-box"),L=C(t({name:"ht-sticky",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:I,setup(t,{expose:$}){const w=t,_=e(`ht-sticky${o()}`),C=e([]),z=s({position:"absolute",boxLeaved:!1,top:0,height:0,width:0,state:""}),{parent:I}=S(T),{proxy:L}=g(),R=i((()=>{const t={"z-index":w.zIndex,height:f(z.height),width:f(z.width)};return z.boxLeaved||(t.position="relative"),`${b(t)};${w.customStyle}`})),j=i((()=>{const t={"z-index":w.zIndex,height:f(z.height),width:f(z.width)};return z.boxLeaved||(t.position="relative"),`${b(t)};`})),N=i((()=>{const t={position:z.position,top:f(z.top)};return b(t)})),P=i((()=>{let t=0;return t=44,44+w.offsetTop}));async function F(t){z.width=t.width,z.height=t.height,await v(),function(){if(0===z.height&&0===z.width)return;const t=P.value+z.height;(function(){for(;0!==C.value.length;)C.value.pop().disconnect()})(),function(){const t=x(L,{thresholds:[0,.5]});return C.value.push(t),t}().relativeToViewport({top:-t}).observe(`#${_.value}`,(t=>{G(t)})),y(`#${_.value}`,!1,L).then((e=>{e.bottom=Number(e.bottom)+44,Number(e.bottom)<=t&&G({boundingClientRect:e})}))}(),I&&I.observerForChild&&I.observerForChild(L)}function G({boundingClientRect:t}){if(I&&z.height>=I.boxStyle.height)return z.position="absolute",void(z.top=0);let e=t.top<=P.value;e=t.top<P.value,e?(z.state="sticky",z.boxLeaved=!1,z.position="fixed",z.top=P.value):(z.state="normal",z.boxLeaved=!1,z.position="absolute",z.top=0)}return $({setPosition:function(t,e,o){z.boxLeaved=t,z.position=e,z.top=o},stickyState:z,offsetTop:w.offsetTop}),(t,e)=>{const o=a(n("ht-resize"),k),s=m;return l(),r(s,{style:d(`${R.value};display: inline-block;`)},{default:u((()=>[h(s,{class:p(`ht-sticky ${t.customClass}`),style:d(j.value),id:_.value},{default:u((()=>[h(s,{class:"ht-sticky__container",style:d(N.value)},{default:u((()=>[h(o,{onResize:F,"custom-style":"display: inline-block;"},{default:u((()=>[c(t.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["style"])])),_:3},8,["class","style","id"])])),_:3},8,["style"])}}}),[["__scopeId","data-v-2ed7126f"]]),R=C(t({name:"ht-sticky-box",options:{addGlobalClass:!0,styleIsolation:"shared"},props:w,setup(t){const i=t,f=e(`ht-sticky-box${o()}`),b=e(new Map),v=s({height:0,width:0}),{proxy:w}=g(),{children:_,linkChildren:C}=z(T);function S(t){v.width=t.width,v.height=t.height;const e=b.value;b.value=new Map;for(const[o]of e){I(_.find((t=>t.$.uid===o)))}e.forEach((t=>{t.disconnect()})),e.clear()}function I(t){!function(t){const e=b.value.get(t.$.uid);e&&(e.disconnect(),b.value.delete(t.$.uid))}(t);const e=function(t){const e=x(w,{thresholds:[0,.5]});return b.value.set(t.$.uid,e),e}(t),o=t.$.exposed;let s=o.stickyState.height+o.offsetTop;s+=44,v.height<=o.stickyState.height&&o.setPosition(!1,"absolute",0),e.relativeToViewport({top:-s}).observe(`#${f.value}`,(t=>{L(o,t)})),y(`#${f.value}`,!1,w).then((t=>{t.bottom=Number(t.bottom)+44,Number(t.bottom)<=s&&L(o,{boundingClientRect:t})})).catch((t=>{console.log(t)}))}function L(t,{boundingClientRect:e}){let o=t.offsetTop;o+=44;const s=t.stickyState.height+o;let i=e.bottom<=s;if(i=e.bottom<s,i)t.setPosition(!0,"absolute",e.height-t.stickyState.height);else if(e.top<=s&&!i){if("normal"===t.stickyState.state)return;t.setPosition(!1,"fixed",o)}}return C({boxStyle:v,observerForChild:I}),$((()=>{b.value=new Map})),(t,e)=>{const o=a(n("ht-resize"),k),s=m;return l(),r(s,{style:{position:"relative"}},{default:u((()=>[h(s,{class:p(`ht-sticky-box ${i.customClass}`),style:d(t.customStyle),id:f.value},{default:u((()=>[h(o,{onResize:S},{default:u((()=>[c(t.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["class","style","id"])])),_:3})}}}),[["__scopeId","data-v-22eb0513"]]);export{L as _,R as a};
