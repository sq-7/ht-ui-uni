import{d as e,r as l,c as a,z as s,v as t,a4 as o,aI as u,K as n,J as i,ay as r,aH as c,aM as d,b as m,e as p,f as v,g as h,w as f,h as g,A as _,p as b,B as y,k,i as C,t as V,F as S,x,j as w,H as $,ab as F,m as K,I}from"./index-Bl407YMq.js";import{b as T,c as z,d as j,m as A,g as B,a as M,_ as W}from"./base64.CiSqhNY6.js";import{f as q,_ as H}from"./ht-picker-view.C2OKaCQs.js";import{f as L,u as O,b as D,F as P}from"./ht-loading.DCn6to1m.js";import{u as R}from"./useTranslate.C8VGrN03.js";const U=W(e({name:"ht-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...T,customLabelClass:z(""),customValueClass:z(""),customViewClass:z(""),label:String,placeholder:String,disabled:j(!1),readonly:j(!1),loading:j(!1),loadingColor:z("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:j(!1),size:String,labelWidth:String,useDefaultSlot:j(!1),useLabelSlot:j(!1),error:j(!1),alignRight:j(!1),beforeConfirm:Function,closeOnClickModal:j(!0),safeAreaInsetBottom:j(!0),ellipsis:j(!1),columnsHeight:A(217),valueKey:z("value"),labelKey:z("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:A(15),prop:String,rules:B(),immediateChange:j(!1),clearable:j(!1)},emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:T,emit:z}){const{translate:j}=R("picker"),A=e,B=z,W=l(null),U=L(),E=l(!1),G=l(!1),J=l(""),N=l(""),Q=l([]),X=l([]),Y=l(!1),Z=l(!1),ee=a((()=>A.loading||E.value));s((()=>A.displayFormat),(e=>{e&&!F(e)&&console.error("The type of displayFormat must be Function"),W.value&&0!==W.value.getSelectedIndex().length&&oe(A.modelValue)}),{immediate:!0,deep:!0}),s((()=>A.modelValue),(e=>{N.value=e,oe(e)}),{deep:!0,immediate:!0}),s((()=>A.columns),(e=>{Q.value=u(e),X.value=u(e),0===e.length?(N.value=n(A.modelValue)?[]:"",J.value=""):oe(A.modelValue)}),{deep:!0,immediate:!0}),s((()=>A.columnChange),(e=>{e&&!F(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:le}=O(P),ae=a((()=>le&&A.prop&&le.errorMessages&&le.errorMessages[A.prop]?le.errorMessages[A.prop]:"")),se=a((()=>{let e=!1;if(le&&le.props.rules){const l=le.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===A.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return A.required||A.rules.some((e=>e.required))||e})),{proxy:te}=I();function oe(e){n(e)&&e.length>0||i(e)&&!n(e)&&""!==e?W.value?r((()=>{de(W.value.getSelects())})):de(function(e){const l=q(A.columns,A.valueKey,A.labelKey);if(0===A.columns.length)return;if(""===e||!i(e)||n(e)&&0===e.length)return;const a=c(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=n(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map((()=>0)));let s=[];e.forEach(((e,a)=>{let t=l[a].findIndex((l=>l[A.valueKey].toString()===e.toString()));t=-1===t?0:t,s.push(t)}));const t=s.map(((e,a)=>l[a][e]));if(1===t.length)return t[0];return t}(e)):J.value=""}function ue(){A.disabled||A.readonly||(B("open"),G.value=!0,N.value=A.modelValue,Q.value=X.value)}function ne(){G.value=!1,B("cancel");let e=setTimeout((()=>{clearTimeout(e),i(W.value)&&W.value.resetColumns(X.value)}),300)}function ie(){if(ee.value)return;if(Y.value)return void(Z.value=!0);const{beforeConfirm:e}=A;e&&F(e)?e(N.value,(e=>{e&&re()}),te.$.exposed):re()}function re(){if(ee.value||A.disabled)return void(G.value=!1);const e=W.value.getSelects(),l=W.value.getValues(),a=W.value.getColumnsData();G.value=!1,X.value=u(a),B("update:modelValue",l),de(e),B("confirm",{value:l,selectedItems:e})}function ce({value:e}){N.value=e}function de(e){if(n(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=A;J.value=(A.displayFormat||d)(e,{valueKey:l,labelKey:a})}function me(){}function pe(){Y.value=!0}function ve(){Y.value=!1,Z.value&&(Z.value=!1,ie())}t((()=>{oe(A.modelValue)})),o((()=>{Q.value=u(A.columns),X.value=u(A.columns)}));const he=a((()=>A.clearable&&!A.disabled&&!A.readonly&&J.value.length));function fe(){const e=n(N.value)?[]:"";B("update:modelValue",e),B("clear")}const ge=a((()=>!A.disabled&&!A.readonly&&!he.value));return T({close:function(){ne()},open:function(){ue()},setLoading:function(e){E.value=e}}),(e,l)=>{const a=K,s=m(p("ht-icon"),M),t=m(p("ht-picker-view"),H),o=m(p("ht-popup"),D);return v(),h(a,{class:b(`ht-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${w(U).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:y(e.customStyle)},{default:f((()=>[g(a,{class:"ht-picker__field",onClick:ue},{default:f((()=>[e.useDefaultSlot?_(e.$slots,"default",{key:0},void 0,!0):(v(),h(a,{key:1,class:"ht-picker__cell"},{default:f((()=>[e.label||e.useLabelSlot?(v(),h(a,{key:0,class:b(`ht-picker__label ${e.customLabelClass}  ${se.value?"is-required":""}`),style:y(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:f((()=>[e.label?(v(),k(S,{key:0},[C(V(e.label),1)],64)):_(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):x("",!0),g(a,{class:"ht-picker__body"},{default:f((()=>[g(a,{class:"ht-picker__value-wraper"},{default:f((()=>[g(a,{class:b(`ht-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${J.value?"":"ht-picker__placeholder"}`)},{default:f((()=>[C(V(J.value?J.value:e.placeholder||w(j)("placeholder")),1)])),_:1},8,["class"]),ge.value?(v(),h(s,{key:0,"custom-class":"ht-picker__arrow",name:"arrow-right"})):he.value?(v(),h(a,{key:1,onClick:$(fe,["stop"])},{default:f((()=>[g(s,{"custom-class":"ht-picker__clear",name:"error-fill"})])),_:1})):x("",!0)])),_:1}),ae.value?(v(),h(a,{key:0,class:"ht-picker__error-message"},{default:f((()=>[C(V(ae.value),1)])),_:1})):x("",!0)])),_:1})])),_:3}))])),_:3}),g(o,{modelValue:G.value,"onUpdate:modelValue":l[1]||(l[1]=e=>G.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:ne,"custom-class":"ht-picker__popup"},{default:f((()=>[g(a,{class:"ht-picker__wraper"},{default:f((()=>[g(a,{class:"ht-picker__toolbar",onTouchmove:me},{default:f((()=>[g(a,{class:"ht-picker__action ht-picker__action--cancel",onClick:ne},{default:f((()=>[C(V(e.cancelButtonText||w(j)("cancel")),1)])),_:1}),e.title?(v(),h(a,{key:0,class:"ht-picker__title"},{default:f((()=>[C(V(e.title),1)])),_:1})):x("",!0),g(a,{class:b("ht-picker__action "+(ee.value?"is-loading":"")),onClick:ie},{default:f((()=>[C(V(e.confirmButtonText||w(j)("done")),1)])),_:1},8,["class"])])),_:1}),g(t,{ref_key:"pickerViewWd",ref:W,"custom-class":e.customViewClass,modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=e=>N.value=e),columns:Q.value,loading:ee.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:ce,onPickstart:pe,onPickend:ve,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-15eb9778"]]);export{U as _};
